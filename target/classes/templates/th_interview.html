<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>面試介面</title>
    <link rel="icon" href="images/favicon.ico" type="image/x-icon"/>
    <!-- Mobile Specific -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!-- CSS Style -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/font-awesome.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/font-face-css.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/owl.carousel.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/jquery.mobile-menu.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/revslider.css}">
    <!-- Google Fonts -->
    <!-- Kevin CSS -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/kevin.css}">
    <script th:src="@{https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js}"></script>
</head>
<body>
        <button class="button" onclick="callBySearchButton()">查詢資料</button>
        <button class="button" onclick="appendInsertForm()">新增資料</button>

        <table>
            <h1 id="testJQ"></h1>
            <div id="putHere1"></div>
        </table>



<script>
    var cnt = 0;
    var data;

    function callBySearchButton() {
        //Empty before appending
        $('#putHere1').empty();

        //calling backend
        var settings = {
            "url": "http://localhost:8081/boot/getAllData",
            "method": "GET",
            "timeout": 0,
        };

        $.ajax(settings).done(function (response) {
            console.log(response);
            data = JSON.parse(response);

            data.forEach(function (e) {
                console.log(e.base64);
                appendData(e.idx, e.aes256, e.base64);
            });
        });
        //calling backend

        $("#putHere1").append(
            `
            <thead>
                <tr>
                    <th>idx</th>
                    <th>Key</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody id="putHere2">
            </tbody>
        `)
    }

    function appendData(idx, aes256, base64) {
        //Append things
        $("#putHere2").append(
            `
                <tr id="item${cnt}" >
                    <td>${idx}</td>
                    <td>${base64.key}</td>
                    <td>${base64.value}</td>
                </tr>
        `)
    }

    function appendInsertForm() {
        //Empty before appending
        $('#putHere1').empty();

        $('#putHere1').append(`
                <div>
                    <div>
                        <label for="key">key:</label>
                        <input id="key" type="text" name="key" value="">
                    </div>
                    <div>
                        <label for="value">value:</label>
                        <input id="value" type="text" name="value" value="">
                    </div>
                    <div>
                        <button class="button" onclick="clearInput()">Cancel</button>
                        <button class="button" onclick="sendInputData()">OK</button>
                    </div>
                </div>

                `)
    }



    function sendInputData(){
        var keyFromInput = $('#key').val();
        var valueFromInput = $('#value').val();

        console.log("keyFromInput = " + keyFromInput);
        console.log("valueFromInput = " + valueFromInput);
        //send Input data to backend
        var settings = {
            "url": "http://localhost:8081/boot/insertData",
            "method": "PUT",
            "timeout": 0,
            "headers": {
                "Content-Type": "application/json"
            },
            "data": JSON.stringify(
                {
                    "key": `${keyFromInput}`,
                    "value": `${valueFromInput}`
                }
            ),
        };

        $.ajax(settings).done(function (response) {
            console.log(response);
        });

        clearInput();
    }

    function clearInput(){
        $('input[type=text]').focus(function (){
            $(this).val('');
        });
    }

</script>
</body>
</html>